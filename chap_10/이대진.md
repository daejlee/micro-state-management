# React Tracked

React Tracked는 속성 감지 기반으로 자동 렌더링 최적화를 수행하는 상태 사용 추적 라이브러리로, Valtio와 동일하게 불필요한 리렌더링 제거 기능을 제공한다.

## 이해하기

React Tracked는 상태 관리 기능을 제공하지 않고 렌더링 최적화 기능을 제공한다. 이를 **상태 사용 추적**이라고 한다. 컨텍스트의 경우를 떠올리면,

```tsx
const NameContext = createContext([
  { firstName: 'react', lastName: 'hooks' },
  () => {},
]);

const useFirstName = () => {
  // const [{ firstName }] = useContext(NameContext); -> lastName 바뀌어도 리렌더링
  const [{ firstName }] = useTracked();
  return firstName;
};
```

## useState + React Tracked

React Tracked를 주로 리액트 컨텍스트를 대체할 용도로 사용한다.

```tsx
import { createContainer } from "react-tracked";

const useValue = () => useState({ count: 0, text: "hello" });
const { Provider, useTracked } = createContainer(useValue);

const Counter = () => {
  const [state, setState] = useTracked();
  ...
}
```

useTracked에 의해 반환된 state 객체는 추적된다. 접근된 속성이 변경된 경우만 리렌더링을 감지한다.
createContext 대신 createContainer를 사용했고, useStateContext 대신 useTracked를 썼을 뿐이다.

useReducer도 문법적으로만 다를 뿐 똑같이 사용된다. 차이점은 useValue가 state와 dispatch가 담긴 튜플을 반환하므로 useTracked도 state와 dispatch가 담긴 튜플을 반환한다는 점이다.

리렌더링을 최적화할 수 있는 이유는 상태 추적 뿐만 아니라 use-context-selector 내부 라이브러리 덕이다. 이 라이브러리의 selector 함수를 사용해 컨텍스트 값을 구독할 수 있고, 이로 제약을 우회한다.

## 향후 전망

React Tracked의 사용 방법은 두 가지가 있는데, 하나는 React Context에서 `createContainer`를 사용하는 방식이고, 다른 하나는 React Redux에서 `createTrackedSelector`를 사용하는 방식이다.

향후 React에서 `useContextSelector` 또는 유사한 기능이 공식적으로 추가될 가능성이 있다. 그렇게 되면 React Tracked는 `use-context-selector`에서 네이티브 훅으로 쉽게 마이그레이션할 수 있고, API 변경 없이 완벽한 호환성을 유지할 수 있다.

구현 설계 관점에서 보면, `createTrackedSelector`는 선택자를 받아 전역 상태를 직접 만들고 관리하는 함수이고, `createContainer`는 `createContext`를 한 번 감싼 함수로서 React Context 사용을 대체하는 역할을 한다. 이 두 함수를 모두 내보내면 각각의 용도에 맞게 다양하게 활용할 수 있다.
