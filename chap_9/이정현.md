# 9 - ì‚¬ìš© ì‚¬ë¡€ ì‹œë‚˜ë¦¬ì˜¤ 3: Valtio

- ë³€ê²½ ê°€ëŠ¥í•œ ê°±ì‹  ëª¨ë¸, Zustandì™€ ê°™ì´ ëª¨ë“ˆ ìƒíƒœ ìš©ë„ë¡œ ì‚¬ìš©
- ReactëŠ” ë¶ˆë³€ì„±ì„ ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½ ê°ì§€ë¥¼ í•˜ê¸° ë•Œë¬¸ì—, Proxy ìì²´ë¥¼ Reactì— ê·¸ëŒ€ë¡œ ì£¼ë©´ ê°ì§€ ëª»í•¨
    - ValtioëŠ” Proxyë¥¼ ë¶ˆë³€ ê°ì²´ë¡œ ë³µì‚¬(ìŠ¤ëƒ…ìˆ)
- Proxyë¥¼ í™œìš©í•œ ìë™ ë¦¬ë Œë”ë§ ìµœì í™” - ìƒíƒœ ì‚¬ìš© ì¶”ì 
    - ì„ íƒì í•„ìš” ì—†ìŒ

# Valtio ì‚´í´ë³´ê¸°

- setStateë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ë¶ˆë³€ì„± ë•Œë¬¸ì´ë‹¤
    
    â‡’ ë¶ˆë³€ì„±ì„ ì§€í‚¤ì§€ ì•Šì•„ë„ ëœë‹¤ë©´? `state.count++`ì™€ ê°™ì´ ìˆ˜ì •ì´ ê°€ëŠ¥
    
    - ê·¸ëŸ¬ë‚˜ ì´ëŠ” Reactì—ì„œ ê°ì§€ë˜ì§€ ì•Šìœ¼ë©°, Proxyë¥¼ í™œìš©í•˜ë©´ ê°ì§€ë˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤

```tsx
const state = { count: 0, text: 'hello' };

const proxyState = new Proxy(state, {
  set(target, prop, value) { // setì€ ê°ì²´ì˜ ê°’ì´ ìƒì‹ ë  ë•Œ ì‹¤í–‰
    target[prop] = value;
    console.log(prop);
  }
});

proxyState.count = 10;  // console: count
proxyState.text = 'world';  // console: text
```

# Snapshot

> Proxyë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ê²½ ê°€ëŠ¥í•œ ê°ì²´ë¡œë¶€í„° ìƒì„±í•œ ë¶ˆë³€ ê°ì²´
> 

```tsx
import { proxy, snapshot } from "valtio";

const state = proxy({ count: 0 });

const snap1 = snapshot(state);
```

- `state`ëŠ” Proxyë¡œ ê°ì‹¼ ë³€ê²½ ê°€ëŠ¥í•œ ê°ì²´
- `snap1`ì€ ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ê°ì²´
    - Object.freezeë¡œ ì½ê¸° ì „ìš© ê°ì²´ë¡œ ë³€í™˜ì‹œí‚´ (ì¶”ê°€, ì‚­ì œ, ìˆ˜ì • ë¶ˆê°€)

```tsx
const snap2 = snapshot(state);
console.log(snap1 === snap2); // true

++state.count;

const snap3 = snapshot(state);
console.log(snap2 === snap3); // false
```

- ì†ì„±ì´ ë³€ê²½ë  ë•Œë§Œ ìƒˆ ìŠ¤ëƒ…ìˆ ìƒì„± â†’ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
    - `snap1`ê³¼ `snap2`ëŠ” ìƒíƒœê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ê°™ì€ ìŠ¤ëƒ…ìˆ ê°ì²´ë¥¼ ê°€ë¦¬í‚´
    - `++state.count`ë¡œ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì—, ìƒˆë¡œ ìƒì„±ëœ `snap3`ëŠ” ì´ì „ ìŠ¤ëƒ…ìˆê³¼ ë‹¤ë¦„
- ì¤‘ì²©ëœ ê°ì²´ ë˜í•œ ë³€ê²½ë˜ì§€ ì•Šì€ ê°ì²´ì˜ ê²½ìš° ê°™ì€ ì°¸ì¡°ë¥¼ ê°€ì§
- ê°€ì¥ ìµœê·¼ ìŠ¤ëƒ…ìˆ 1ê°œë§Œì„ ìºì‹± (ìµœê·¼ ìŠ¤ëƒ…ìˆ í•œ ê°œì™€ë§Œ ë¹„êµí•´ì„œ ê°™ìœ¼ë©´ ì¬ì‚¬ìš©, ë‹¤ë¥´ë©´ ìƒˆë¡œ ìƒì„±)

# ë¦¬ë Œë”ë§ ìµœì í™”

```tsx
const Counter1 = () => {
  const snap = useSnapshot(state);
  const inc = () => ++state.count1;
  return (
    <>
      {snap.count1} <button onClick={inc}>+1</button>
    </>
  );
};
```

`snap.count1`ì™€ ê°™ì´ ì ‘ê·¼ â†’ `useSnapshot`ì— ì˜í•´ ì¶”ì  ì •ë³´ë¡œ ê°ì§€ â†’ í•„ìš”í•œ ê²½ìš° ë¦¬ë Œë”ë§

- ì¶”ì  ì •ë³´: ì»´í¬ë„ŒíŠ¸ê°€ ì–´ë–¤ ì†ì„±ì— ì ‘ê·¼í–ˆëŠ”ì§€

```tsx
const Counter2 = () => {
  const snap = useSnapshot(state);
  const inc = () => ++state.count2;
  return (
    <>
      {snap.count2} <button onClick={inc}>+1</button>
    </>
  );
};

const App = () => (
  <>
    <Counter1 />
    <Counter2 />
  </>
);
```

ì¶”ì  ì •ë³´ë¥¼ ê¸°ì–µí•˜ê³  ìˆê¸° ë•Œë¬¸ì— `Counter1`ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ `Counter1`ëŠ” ë¦¬ë Œë”ë§ ë˜ê³ , `Counter2`ëŠ” ë¦¬ë Œë”ë§ ë˜ì§€ ì•ŠëŠ”ë‹¤

```tsx
const TodoItem = ({ id, title, done }: {
  id: string;
  title: string;
  done: boolean;
}) => (
  <div>
    <input type="checkbox" checked={done} onChange={() => toggleTodo(id)} />
    <span style={{ textDecoration: done ? "line-through" : "none" }}>{title}</span>
    <button onClick={() => removeTodo(id)}>Delete</button>
  </div>
);

const MemoedTodoItem = memo(TodoItem);

const TodoList = () => {
  const { todos } = useSnapshot(state);
  return (
    <>
      {todos.map(({ id, title, done }) => (
        <MemoedTodoItem key={id} id={id} title={title} done={done} />
      ))}
    </>
  );
};
```

ë©”ëª¨ëœ ì»´í¬ë„ŒíŠ¸ì— ê°ì²´ ì „ë‹¬ ì‹œ ì ‘ê·¼ì„ ìƒëµ (ìƒíƒœ ì‚¬ìš© ì¶”ì  â†’ ì†ì„± ì ‘ê·¼ ê°ì§€)

â‡’ ì†ì„±ì„ ë”°ë¡œ ë°›ìŒ

```tsx
const TodoItem = ({ id }: { id: string }) => {
  const todoState = state.todos.find((todo) => todo.id === id);
  if (!todoState) throw new Error("invalid todo id");

  const snap = useSnapshot(todoState);
  const { title, done } = snap;

  return (
    <div>
      <input type="checkbox" checked={done} onChange={() => toggleTodo(id)} />
      <span style={{ textDecoration: done ? "line-through" : "none" }}>
        {title}
      </span>
      <button onClick={() => removeTodo(id)}>Delete</button>
    </div>
  );
};
```

`id`ë¡œ `state`ë¥¼ ì°¾ì•„ `snap`ì—ì„œ ì†ì„±ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ ë¦¬ë Œë”ë§ ê°œì„ ì´ ê°€ëŠ¥

```tsx
const TodoList = () => {
  const { todos } = useSnapshot(state);
  const todoIds = todos.map((todo) => todo.id);
  return (
    <div>
      {todoIds.map((todoId) => (
        <MemoedTodoItem key={todoId} id={todoId} />
      ))}
    </div>
  );
};
```

`TodoList`ê°€ `ids`ë§Œ ë³´ë‚´ì£¼ê¸° ë•Œë¬¸ì— `id`ê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ì´ìƒ `TodoList`ëŠ” ë¦¬ë Œë”ë§ ë˜ì§€ ì•ŠëŠ”ë‹¤

# ì£¼ì˜ì ê³¼ ì¥ë‹¨ì 

âš ï¸

- ë³€ê²½ ê°€ëŠ¥í•œ ëª¨ë¸ê³¼ ë¶ˆë³€ ëª¨ë¸, ë‘ ê°€ì§€ê°€ ìˆì§€ë§Œ ReactëŠ” ë¶ˆë³€ ìƒíƒœë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ í•˜ë¯€ë¡œ í˜¼ë™í•˜ì§€ ì•Šì•„ì•¼ í•¨
    - Valtio ìƒíƒœì™€ React ìƒíƒœë¥¼ ëª…í™•íˆ ë¶„ë¦¬í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤

ğŸ‘

- ë„¤ì´í‹°ë¸Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ë¥¼ ì“¸ ìˆ˜ ìˆë‹¤ (splice, slice, â€¦)
- ì¤‘ì²©ëœ ê°ì²´ì˜ ê°’ì„ ì§§ì€ ì½”ë“œë¡œ ë³€ê²½ ê°€ëŠ¥í•˜ë‹¤

ğŸ‘

- ë–¨ì–´ì§€ëŠ” ì˜ˆì¸¡ ê°€ëŠ¥ì„±
- ë Œë”ë§ ìµœì í™”ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ë””ë²„ê¹…ì´ í˜ë“¬