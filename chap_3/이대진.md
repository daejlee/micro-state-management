# 3. ë¦¬ì•¡íŠ¸ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ìš©í•œ ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ê³µìœ 

ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ìš©í•´ propsë¥¼ ëŒ€ì‹ í•´ ì»´í¬ë„ŒíŠ¸ê°„ ë°ì´í„° ì „ë‹¬ì´ ê°€ëŠ¥í•˜ë‹¤. ì»¨í…ìŠ¤íŠ¸ë¥¼ ì»´í¬ë„ŒíŠ¸ ìƒíƒœì™€ ê²°í•©í•˜ë©´ ì „ì—­ ìƒíƒœë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤.

ë‹¤ë§Œ ì»¨í…ìŠ¤íŠ¸ëŠ” ì „ì—­ ìƒíƒœë¥¼ ìœ„í•´ ì„¤ê³„ëœ ê²ƒì€ ì•„ë‹ˆë‹¤. ìƒíƒœê°€ ê°±ì‹ ë  ë•Œ ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ ì†Œë¹„ìê°€ ë¦¬ë Œë”ë§ë˜ë¯€ë¡œ ì „ì—­ ìƒíƒœë¥¼ ì—¬ëŸ¬ ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤.

## useStateì™€ useContext íƒêµ¬í•˜ê¸°

2ì¥ì˜ ìƒíƒœ ëŒì–´ì˜¬ë¦¬ê¸° íŒ¨í„´ì˜ ì˜ˆì œë¥¼ ë‹¤ì‹œ ë³´ì.

```tsx
const Parent = ({ count, setCount }) => (
	<>
		<Component1 count={count} setCount={setCount />
		<Component1 count={count} setCount={setCount />
	</>
);
```

ì´ë ‡ê²Œ ë¶€ëª¨ì—ì„œ ìì‹ìœ¼ë¡œ propsë¥¼ ì „ë‹¬í•˜ëŠ” ì‘ì—…ì„ props drillingì´ë¼ê³  í•œë‹¤.

ì•±ì˜ ê·œëª¨ê°€ ì»¤ì§€ë©´ íŠ¸ë¦¬ ì•„ë˜ë¡œ propsë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ë¶€ì ì ˆí•  ìˆ˜ ìˆë‹¤. ë˜ ë¶€ëª¨ê°€ `count` ìƒíƒœì— ëŒ€í•´ ì•Œê³  ìˆëŠ” ê²ƒì´ ë¶ˆí•„ìš”í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, `Parent`ì—ì„œ `count`ë¥¼ ì œê±°í•˜ëŠ” ê²ƒì´ ë” í•©ë¦¬ì ì¼ ìˆ˜ ìˆë‹¤.

### ì •ì  ê°’ì„ ì´ìš©í•´ useContext ì‚¬ìš©í•˜ê¸°

ë¦¬ì•¡íŠ¸ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ propsë¥¼ ì œê±°í•˜ê³  ë¶€ëª¨ê°€ íŠ¸ë¦¬ ì•„ë˜ì— ìˆëŠ” ìì‹ì—ê²Œ ê°’ì„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤. ì»¨í…ìŠ¤íŠ¸ëŠ” ì—¬ëŸ¬ providerê°€ ì¡´ì¬í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” ì¤‘ì²©ë  ìˆ˜ ìˆìœ¼ë©° ì´ë¥¼ ì†Œë¹„í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ê°€ì¥ ê°€ê¹Œìš´ providerë¥¼ ì„ íƒí•´ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.

```tsx
const ColorContext = createContext('black');
const Component = () => {
  const color = useContext(ColorContext);
  return <div style={{ color }}>Hello {color}</div>;
};
const App = () => (
  <>
    <Component />
    <ColorContext.Provider value='red'>
      <Component />
    </ColorContext.Provider>
    <ColorContext.Provider value='green'>
      <Component />
    </ColorContext.Provider>
    <ColorContext.Provider value='blue'>
      <Component />
    </ColorContext.Provider>
  </>
);
```

### useContextì™€ í•¨ê»˜ useState ì‚¬ìš©í•˜ê¸°

useStateì™€ useContextë¥¼ í•¨ê»˜ ì‚¬ìš©í•´ë³´ì. props ëŒ€ì‹  ì»¨í…ìŠ¤íŠ¸ì—ì„œ ìƒíƒœì™€ ê°±ì‹  í•¨ìˆ˜ë¥¼ ì „ë‹¬í•œë‹¤.

```tsx
const CountStateContext = createContext({
	count: 0,
	setCount: () => {},
});

const App = () => {
	const [count, setCount] = useState(0);
	return (
		<CountStateContext.Provider
			value={{ count, setCount }}
		>
			<Parent />
		</CounterStateContext.Provider>
	);
};

const Component = () => {
	const { count, setCount } = useContext(CountStateContext);
	return (
		<div>
			{count}
			<button onClick={() => setCount((c) => c + 1}>
				+1
			</button>
		</div>
	);
};
```

ì—¬ëŸ¬ providerë¥¼ í†µí•´ ê²©ë¦¬ëœ ì¹´ìš´í„° ìƒíƒœë¥¼ ì œê³µí•  ìˆ˜ ìˆìœ¼ë©°, ì´ê²ƒì€ ë¦¬ì•¡íŠ¸ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¤‘ìš”í•œ ì´ìœ ì´ë‹¤.

## ì»¨í…ìŠ¤íŠ¸ ì´í•´í•˜ê¸°

ì»¨í…ìŠ¤íŠ¸ ì „íŒŒì˜ ì‘ë™ ë°©ì‹ê³¼ í•œê³„ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

### ì»¨í…ìŠ¤íŠ¸ ì „íŒŒì˜ ì‘ë™ ë°©ì‹

ì»¨í…ìŠ¤íŠ¸ ê³µê¸‰ìê°€ ìƒˆ ì»¨í…ìŠ¤íŠ¸ ê°’ì„ ë°›ìœ¼ë©´ ëª¨ë“  ì†Œë¹„ìê°€ ë¦¬ë Œë”ë§ëœë‹¤.
ì»¨í…ìŠ¤íŠ¸ ê°’ì´ ë³€ê²½ë˜ì§€ ì•Šì•˜ëŠ”ë° ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•˜ë ¤ë©´ â€˜ë‚´ìš© ëŒì–´ì˜¬ë¦¬ê¸°â€™ë‚˜ memoë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```tsx
const App = () => {
  const [color, setColor] = useState('red');
  return (
    <ColorContext.Provider value={color}>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      <ul>
        <li>
          <DummyComponent />
        </li>
        <li>
          <MemoedDummyComponent />
        </li>
        <li>
          <ColorComponent />
        </li>{' '}
        (ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©)
        <li>
          <MemoedColorComponent />
        </li>
      </ul>
    </ColorContext.Provider>
  );
};
```

ìœ„ ì˜ˆì‹œì—ì„œ í…ìŠ¤íŠ¸ ì…ë ¥ì´ ë°”ë€Œë©´ Appì´ ë¦¬ë Œë”ë§ë˜ê³ , ColorContext.ProviderëŠ” ìƒˆ ê°’ì„ ë°›ì•„ ë¦¬ìŠ¤íŠ¸ê°€ ë¦¬ë Œë”ë§ëœë‹¤.

- `DummyComponent(state)`, `ColorComponent(state, context)` ë¦¬ë Œë”ë§
- `MemoedDummyComponent` ë¦¬ë Œë”ë§ X
- **`MemoedColorComponent(context)` ë¦¬ë Œë”ë§**

memoëŠ” ë‚´ë¶€ ì»¨í…ìŠ¤íŠ¸ ì†Œë¹„ìì˜ ë¦¬ë Œë”ë§ì„ ë§‰ì§€ ëª»í•œë‹¤. ë§Œì•½ ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ì¼ê´€ë˜ì§€ ì•Šì€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ ë¶ˆê°€í”¼í•˜ë‹¤.

### ì»¨í…ìŠ¤íŠ¸ì— ê°ì²´ë¥¼ ì‚¬ìš©í•  ë•Œì˜ í•œê³„ì 

ì»¨í…ìŠ¤íŠ¸ ê°’ìœ¼ë¡œ ê°ì²´ë¥¼ ì“¸ ë•ŒëŠ” ì£¼ì˜ê°€ í•„ìš”í•˜ë‹¤. ì—¬ëŸ¬ ê°’ì´ í¬í•¨ëœ ê°ì²´ì—ì„œ ì†Œë¹„ìê°€ ëª¨ë“  ê°’ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. ì´ ê²½ìš° ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì´ ê°€ëŠ¥í•˜ë‹¤.

```tsx
const App = () => {
  const [count1, setCount1] = useState(0);
  const [count2, setCount2] = useState(0);
  return (
    <CountContext.Provider value={{ count1, count2 }}>
      <button onClick={() => setCount1((c) => c + 1)}>{count1}</button>
      <button onClick={() => setCount2((c) => c + 1)}>{count2}</button>
      <MemoCounter1 /> (counter2 ë³€ê²½ì—ë„ ë¦¬ë Œë”ë§)
      <MemoCounter2 /> (counter1 ë³€ê²½ì—ë„ ë¦¬ë Œë”ë§)
    </CountContext.Provider>
  );
};
```

## ì „ì—­ ìƒíƒœë¥¼ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ ë§Œë“¤ê¸°

ì»¨í…ìŠ¤íŠ¸ ë™ì‘ì„ ê¸°ë°˜ìœ¼ë¡œ ì „ì—­ ìƒíƒœì™€ í•¨ê»˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‘ ê°€ì§€ í•´ê²°ì±…ì„ ì‚´í´ë³¸ë‹¤.

- ì‘ì€ ìƒíƒœ ì¡°ê° ë§Œë“¤ê¸°
- useReducerë¡œ í•˜ë‚˜ì˜ ìƒíƒœë¥¼ ë§Œë“¤ê³  ì—¬ëŸ¬ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „íŒŒ

### ì‘ì€ ìƒíƒœì¡°ê° ë§Œë“¤ê¸°

ì „ì—­ ìƒíƒœë¥¼ ì—¬ëŸ¬ ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆˆë‹¤.

```tsx
const App = () => )
	<Count1Provider>
		<Count2Provider>
			<Parent />
		</Count2Provider>
	</Count1Provider>
);
```

ê°ì²´ê°€ í•œ ë²ˆ ì‚¬ìš©ë˜ê³  ì‚¬ìš©ì‹œ ì»¨í…ìŠ¤íŠ¸ì˜ ë™ì‘ì— ë¬¸ì œê°€ ì—†ë‹¤ë©´ ê°ì²´ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì‚¬ìš©í•´ë„ ì¢‹ë‹¤.

```tsx
const [user, setUser] = useState({
  firstName: 'react',
  lastName: 'hooks',
});
```

ì´ ê²½ìš° ì»¨í…ìŠ¤íŠ¸ë¥¼ ìª¼ê°¤ í•„ìš”ê°€ ì—†ë‹¤.

### useReducerë¡œ í•˜ë‚˜ì˜ ìƒíƒœë¥¼ ë§Œë“¤ê³  ì—¬ëŸ¬ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „íŒŒí•˜ê¸°

ë‹¨ì¼ ìƒíƒœë¥¼ ì—¬ëŸ¬ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•´ ìƒíƒœ ì¡°ê°ì„ ë°°í¬í•œë‹¤. ê°±ì‹  í•¨ìˆ˜ ë°°í¬ëŠ” ë³„ë„ ì»¨í…ìŠ¤íŠ¸ê°€ í•„ìš”í•˜ë‹¤.

```tsx
type Action = { type: "INC1" } | { type: "INC2" |;
const Count1Context = createContext<number>(0);
const Count2Context = createContext<number>(0);
const DispatchContext = createContext<Dispatch<Action>>(
	() => {}
);

const Provider = ({ children }: { children: ReactNode }) => {
	const [state, dispatch] = useReducer(...) => {
		if (action.type === "INC1") return { ...prev, count1: prev.count1 + 1 };
		if (action.type === "INC2") return { ...prev, count2: prev.count2 + 1 };
		// ì¶”ê°€ ì¼€ì´ìŠ¤ ì •ì˜ ê°€ëŠ¥ ex. INC_BOTH, ..
		throw new Error("no matching action");
	},
	{...}
);
return (
		<DispatchContext.Provider value=(dispatch}>
			<Count1Context.Provider value={state.count1}>
				<Count2Context.Provider value={state.count2}>
					{children}
				</Count2Context.Provider>
			</Count1Context.Provider>
		</DispatchContext.Provider>
	);
);
```

<aside>

    ğŸ’¡ ë¦¬ë Œë”ë§ ë°©ì§€ë¥¼ ìœ„í•´ ìƒíƒœë¥¼ ìª¼ê°œ ì»¨í…ìŠ¤íŠ¸ë¡œ ë°°í¬í•˜ëŠ” ê°œë…ì€ ê³µìœ í•˜ëŠ”ë“¯.
    í›„ìì˜ ë¦¬ë“€ì„œ ì‚¬ìš© ì¼€ì´ìŠ¤ê°€ ë””ìŠ¤í˜ì²˜ ì„¤ì •ì´ ê°€ëŠ¥í•´ì„œ ë” ìœ ìš©í•  ê²ƒ ê°™ë‹¤.

</aside>

## ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ì„ ìœ„í•œ ëª¨ë²” ì‚¬ë¡€

ì „ì—­ ìƒíƒœë¥¼ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë‹¤ë£¨ëŠ” ì„¸ íŒ¨í„´ì´ ìˆë‹¤.

- ì»¤ìŠ¤í…€ í›…ê³¼ Provider ì»´í¬ë„ŒíŠ¸ íŒ¨í„´
- ì»¤ìŠ¤í…€ í›…ì´ ìˆëŠ” íŒ©í† ë¦¬ íŒ¨í„´
- reduceRightì„ ì´ìš©í•œ ê³µê¸‰ì ì¤‘ì²© ë°©ì§€

### ì»¤ìŠ¤í…€ í›…ê³¼ ê³µê¸‰ì ì»´í¬ë„ŒíŠ¸

ì´ì „ê¹Œì§€ëŠ” useContextë¡œ ì§ì ‘ ì»¨í…ìŠ¤íŠ¸ ê°’ì„ ê°€ì ¸ì™”ì§€ë§Œ, ì»¨í…ìŠ¤íŠ¸ ê°’ì— ì ‘ê·¼í•  ì»¤ìŠ¤í…€ í›…ì„ ìƒì„±í•œë‹¤. ê¸°ë³¸ ê°’ì„ nullë¡œ ë§Œë“¤ê³  ì»¤ìŠ¤í…€ í›…ì—ì„œ ê°’ì´ nullì¸ì§€ í™•ì¸í•œë‹¤. ì´ëŸ¬ë©´ ê³µê¸‰ìì—ì„œ ì»¤ìŠ¤í…€ í›…ì´ ì“°ì´ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```tsx
type CountContextType = [number, Dispatch<SetStateAction<number>>];
const Count1Context = createContext<CountContextType | null >(null);

export const Count1Provider = (...) => (
	// JSXì—ì„œ ì•„ë˜ì²˜ëŸ¼ ìƒíƒœì£¼ì… ê°€ëŠ¥
	<Count1Context.Provider value={useState(0)}>
		{children}
	</Counter1Context.Provider>
);

export const useCount1 = () => {
	const value = useContext(Counter1Context);
	if (value === null) throw new Error("Provider missing"); // ëª…ì‹œì  ì—ëŸ¬ë¡œ ë””ë²„ê¹…
	return value;
};

const Counter1 = () => {
	const [count1, setCount1] = useCount1();
	return (
		<div>
			Count1: {count1}
			<button onClick={() => setCount1((c) => c + 1)}>
				+1
			</button>
		</div>
	);
};
```

ì»´í¬ë„ŒíŠ¸ ì…ì¥ì—ì„œ useCount1 í›…ì— ìˆ¨ê²¨ì§„ ì»¨í…ìŠ¤íŠ¸ì— ëŒ€í•´ ëª¨ë¥¸ë‹¤ëŠ” ì ì´ ì£¼ëª©í• ë§Œ í•˜ë‹¤.

<aside>
  
  
    ğŸ’¡ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ì´ìš© ë¶€ë¶„ì„ ì¶”ìƒí™”í–ˆë‹¤ê³  ì´í•´í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.

</aside>

### ì»¤ìŠ¤í…€ í›…ì´ ìˆëŠ” íŒ©í† ë¦¬ íŒ¨í„´

ì»¤ìŠ¤í…€ í›…ê³¼ ê³µê¸‰ì ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“œëŠ” ê±´ ë°˜ë³µì ì´ë‹¤. ì´ˆê¹ƒê°’ì„ ë°›ì•„ ìƒíƒœë¥¼ ë°˜í™˜í•˜ëŠ” useValue ì»¤ìŠ¤í…€í›…ì„ ì‚¬ìš©í•˜ëŠ” createStateContext í•¨ìˆ˜ê°€ ìˆë‹¤. useStateê°€ [state, setState]ë¥¼ ë°˜í™˜í•˜ë“¯ì´ createStateContextëŠ” [ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” ì»¤ìŠ¤í…€ í›…, ê³µê¸‰ì ì»´í¬ë„ŒíŠ¸] íŠœí”Œì„ ë°˜í™˜í•œë‹¤.

ë˜í•œ ê³µê¸‰ì ì»´í¬ë„ŒíŠ¸ëŠ” useValueì— ì „ë‹¬ë˜ëŠ” ì„ íƒì  initialValueë¥¼ ë°›ì•„ ì´ˆê¹ƒê°’ ì •ì˜ ëŒ€ì‹  ëŸ°íƒ€ì„ì— ìƒíƒœì˜ ì´ˆê¹ƒê°’ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

```tsx
const createStateContext = (
	useValue: (init) => State,
) = > {
	const StateContext = createContext(null);
	const StateProvider = ({
		initialValue,
		children,
	}) => (
		<StateContext.Provider value={useValue(initialValue)}>
			{children}
		</StateContext.Provider>
	);
	const useContextState = () => {
		const value = useContext(StateContext);
		if (value === null) throw new Error ("Provider missing");
		return value;
	};
	return [StateProvider, useContextState] as const;
};

const useNumberState = (init) => useState(init || 0);
// useReducerë¥¼ ì´ìš©í•œ ì»¤ìŠ¤í…€ í›…ì„ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.
const useMyState = () => useReducer({}, (prev, action) => {
	if (action.type === 'SET_F00') {
		return { ...prev, foo: action.foo };
	}
	// ...
};
const [Count1Provider, useCount1] = createStateContext(useNumberState);
```

### reduceRightì„ ì´ìš©í•œ ê³µê¸‰ì ì¤‘ì²© ë°©ì§€

ì¤‘ì²©ëœ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ëŠ” ì˜ëª»ë˜ì§„ ì•Šì•˜ì§€ë§Œ ë¶ˆí¸í•  ìˆ˜ ìˆë‹¤.

```tsx
		...
		<DispatchContext.Provider value=(dispatch}>
			<Count1Context.Provider value={state.count1}>
				<Count2Context.Provider value={state.count2}>
					{children}
				</Count2Context.Provider>
			</Count1Context.Provider>
		</DispatchContext.Provider>
		...

const App = () => {
	const providers = [
		[Count1Provider, { initialValue: 10 }],
		[Count2Provider, { initialValue: 20 }],
		[Count3Provider, { initialValue: 30 }],
		[Count4Provider, { initialValue: 40 }],
		[Count5Provider, { initialValue: 50 }],
	] as const;
	return providers.reduceRight(
		(children, [Component, props]) =>
			createElement(Component, props, children),
		<Parent />,
	);
};
```

ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ê°™ì€ ê¸°ë²•ì„ ì“¸ ìˆ˜ ìˆì§€ë§Œ, reduceRightì„ ì´ìš©í•´ ê³µê¸‰ì íŠ¸ë¦¬ë¥¼ êµ¬ì„±í•œë‹¤ëŠ” ì ì€ ê°™ë‹¤. ì´ ê¸°ë²•ì€ ì „ì—­ ìƒíƒœ ì»¨í…ìŠ¤íŠ¸ ë¿ë§Œ ì•„ë‹ˆë¼ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.
